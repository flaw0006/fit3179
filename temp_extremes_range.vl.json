{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Min–max temperature range by state (2024). Uses rule + endpoints (dumbbell).",
  "width": 720,
  "height": 420,
  "data": { "url": "Min_Max_Temp_Data/Clean_MinMax_Temp.csv" },

  "transform": [
    {"calculate": "toNumber(datum.year)", "as": "year_num"},
    {"filter": "datum.year_num == 2024"},

    {"calculate": "datum.state === 'Southern Australia' ? 'South Australia' : datum.state", "as": "state_fix"},

    {"pivot": "type", "value": "temp", "groupby": ["state_fix"]},
    {"calculate": "toNumber(datum.min)", "as": "min_c"},
    {"calculate": "toNumber(datum.max)", "as": "max_c"}
  ],

  "layer": [
    {
      "mark": {"type": "rule", "strokeWidth": 3},
      "encoding": {
        "x": {"field": "state_fix", "type": "nominal", "title": "State/Territory", "axis": {"labelAngle": 0}},
        "y": {"field": "min_c", "type": "quantitative", "title": "Temperature (°C)"},
        "y2": {"field": "max_c"},
        "color": {"value": "#888"}  
      }
    },
    {
      "transform": [{"fold": ["min_c", "max_c"], "as": ["which", "temp_c"]}],
      "mark": {"type": "point", "filled": true, "size": 80},
      "encoding": {
        "x": {"field": "state_fix", "type": "nominal"},
        "y": {"field": "temp_c", "type": "quantitative"},
        "color": {
          "field": "which",
          "type": "nominal",
          "title": "Extreme",
          "scale": {"domain": ["min_c", "max_c"], "range": ["#2C7BB6", "#D7191C"]},
          "legend": {"orient": "bottom", "labelExpr": "datum.value==='min_c' ? 'Min' : 'Max'"}
        },
        "tooltip": [
          {"field": "state_fix", "title": "State"},
          {"field": "min_c", "title": "Min (°C)", "format": ".1f"},
          {"field": "max_c", "title": "Max (°C)", "format": ".1f"}
        ]
      }
    }
  ],

  "config": {
    "axis": {"grid": true, "gridOpacity": 0.15, "labelColor": "#333", "titleColor": "#333"},
    "view": {"stroke": null},
    "background": "white"
  }
}
